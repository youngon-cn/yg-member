import { define, WeElement } from 'omi'
import { checkLogin, gotoLogin, getUtype } from '../../utils/tools'
import { common } from '../../store/config'
import store from '../../store/admin-store'

define('hello-element', class extends WeElement {
  css = require('./_index.css')
  user = {}
  isLogin = false
  install() {
    checkLogin().then(rs => {
      if (rs) {
        this.user = rs
        this.isLogin = true
        this.update()
      }
    })
  }

  toLogin = () => {
    gotoLogin()
  }

  enter = () => {
    alert('enter')
  }

  logout = () => {
    store.logout()
    this.user = null
    this.isLogin = false
    this.update()
    window.location.href = document.URL.includes('?')
      ? document.URL.split('?')[0]
      : document.URL
  }

  toLoginHtml() {
    return (
      <div title="去登录">
        <svg
          class="icon"
          style="width: 3em; height: 3em;color: #465666;vertical-align: middle;fill: currentColor;overflow: hidden;margin: 0 10px;"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="1564"
          onClick={this.toLogin}
        >
          <path
            d="M508.341333 640.32l97.834667-97.834667a42.666667 42.666667 0 0 0 0-60.341333l-97.834667-97.824a32 32 0 0 0-45.248 0c-12.490667 12.490667-12.490667 31.424 0 43.914667l53.408 52.085333H117.333333a32 32 0 1 0 0 64h393.845334l-48.085334 49.418667c-12.490667 12.501333-12.490667 33.418667 0 45.92 12.48 12.501333 32.757333 13.152 45.248 0.661333zM245.333333 341.333333a32 32 0 0 0 32-32V192a42.666667 42.666667 0 0 1 42.666667-42.666667h512a42.666667 42.666667 0 0 1 42.666667 42.666667v640a42.666667 42.666667 0 0 1-42.666667 42.666667H320a42.666667 42.666667 0 0 1-42.666667-42.666667V714.666667a32 32 0 1 0-64 0v138.666666a85.333333 85.333333 0 0 0 85.333334 85.333334h554.666666a85.333333 85.333333 0 0 0 85.333334-85.333334V170.666667a85.333333 85.333333 0 0 0-85.333334-85.333334H298.666667a85.333333 85.333333 0 0 0-85.333334 85.333334v138.666666a32 32 0 0 0 32 32z"
            p-id="1565"
          />
        </svg>
      </div>
    )
  }

  toEnterAdmin() {
    return (
      <div title="进入管理">
        <svg
          class="icon"
          style="width: 3em; height: 3em;color: #007acc;vertical-align: middle;fill: currentColor;overflow: hidden;margin: 0 10px;"
          viewBox="0 0 1092 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="2014"
          onClick={this.enter}
        >
          <path
            d="M1092.458509 111.402462l-0.179717-1.696085c-0.078626-0.741335-0.19095-1.48267-0.280809-2.24647V95.86812A95.980444 95.980444 0 0 0 996.129863 0H495.762299a95.980444 95.980444 0 0 0-95.86812 95.86812v170.574491a31.843717 31.843717 0 0 0 63.687433 0V95.86812a32.225617 32.225617 0 0 1 32.180687-32.191919h397.243344l-182.053953 92.599506c-23.138644 8.042364-40.88576 17.971762-54.184864 30.259955-17.870671 16.522789-27.687747 37.06676-29.204114 61.193851l-0.067394 0.988447v558.247871H495.762299a32.214384 32.214384 0 0 1-32.180687-32.135758V607.906097a31.843717 31.843717 0 0 0-63.687433 0v166.923976a95.980444 95.980444 0 0 0 95.86812 95.86812h131.755484v58.307137l0.134788 1.460206c3.01027 32.573819 16.174586 59.598857 37.06676 76.18904a79.592443 79.592443 0 0 0 50.253541 17.342751 91.554897 91.554897 0 0 0 12.759951-0.898588l4.998396-0.685174L1007.317285 889.029391c29.428761-10.580875 69.078962-31.079917 82.557783-85.770236l0.932286-3.740374v-16.354303a31.967272 31.967272 0 0 0 1.123235-8.345638V308.148332l0.460526-195.049785z m-108.010292 718.174092l-1.729782 0.606547-267.846655 130.11556a16.309374 16.309374 0 0 1-10.55841-3.549423c-6.739411-5.335367-11.591787-16.848527-13.108154-30.799108V250.728551c0.527921-7.435817 3.01027-21.611044 42.357197-34.887684l2.246471-0.741335L997.376654 82.041096c16.09596 3.96502 27.80007 15.365857 30.945128 30.38351v195.74619l-1.123235 483.170834c-5.672338 19.061301-17.275357 29.293973-42.75033 38.234924zM494.987267 436.904777a31.686464 31.686464 0 0 0-0.887356-7.424584 31.675231 31.675231 0 0 0-9.289155-20.982033L313.809437 237.485608a31.843717 31.843717 0 1 0-45.019265 45.030498l122.544955 122.544955h-359.435249a31.843717 31.843717 0 1 0 0 63.687433h352.280241L265.869761 587.04762a31.843717 31.843717 0 0 0 45.030497 45.030497l166.912743-166.923976a31.821252 31.821252 0 0 0 17.174266-28.249364z"
            p-id="2015"
          />
        </svg>
      </div>
    )
  }

  logoutHtml() {
    return (
      <div class="logout" title="注销登录" onClick={this.logout}>
        <svg
          t="1555686208552"
          class="icon"
          style="width: 1.0830078125em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;"
          viewBox="0 0 1109 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="3189"
        >
          <path
            d="M2.944 495.658667c0-14.506667-1.450667-29.226667 0.298667-43.52 3.242667-26.624 7.125333-53.248 12.885333-79.36 10.112-45.994667 28.074667-89.258667 50.773333-130.56 13.610667-24.832 29.141333-48.554667 47.232-70.485334 11.52-13.909333 23.68-27.306667 35.925334-40.533333 28.629333-31.104 61.696-57.130667 97.450666-79.658667 17.066667-10.709333 34.730667-20.906667 53.333334-28.672 19.84-8.32 39.509333-0.725333 50.773333 16.256 13.354667 20.266667 6.058667 48.768-15.189333 59.349334a425.642667 425.642667 0 0 0-78.08 48.938666c-18.944 15.36-37.12 31.914667-53.973334 49.493334A412.458667 412.458667 0 0 0 145.237333 276.565333a382.933333 382.933333 0 0 0-32.853333 71.338667c-6.826667 20.693333-13.098667 41.685333-17.621333 62.976-3.754667 17.578667-5.205333 35.754667-6.613334 53.76a410.752 410.752 0 0 0 8.106667 123.008 435.797333 435.797333 0 0 0 74.112 165.76c16.213333 22.4 34.304 43.221333 54.442667 62.208a453.973333 453.973333 0 0 0 81.28 61.056c30.72 18.133333 62.890667 33.066667 97.28 42.538667 22.058667 6.101333 44.586667 10.624 67.072 14.933333 28.586667 5.546667 57.6 6.314667 86.528 4.864 19.626667-0.981333 39.210667-4.48 58.752-7.168 32.384-4.394667 63.274667-14.293333 93.269333-26.624a418.858667 418.858667 0 0 0 97.152-55.338667c12.970667-9.984 25.941333-20.138667 37.888-31.232 29.952-27.776 55.466667-59.136 76.8-93.909333a407.04 407.04 0 0 0 46.677333-105.770667c5.418667-19.882667 9.685333-40.064 13.781334-60.245333 1.834667-9.002667 2.218667-18.346667 2.730666-27.605333 0.725333-12.672 1.152-25.301333 1.28-37.973334 0.426667-39.082667-5.632-77.312-15.914666-114.986666a415.36 415.36 0 0 0-35.456-88.661334c-15.104-27.818667-32.298667-54.4-53.717334-78.037333-12.885333-14.208-25.685333-28.629333-39.808-41.6a421.674667 421.674667 0 0 0-77.482666-56.661333c-7.509333-4.266667-14.848-8.832-22.314667-13.226667-8.832-5.290667-12.842667-13.952-15.061333-23.125333a40.746667 40.746667 0 0 1 7.509333-35.242667c11.648-15.786667 35.072-21.546667 51.2-12.544 22.186667 12.330667 44.373333 24.874667 64.938667 39.552 20.224 14.421333 38.741333 31.274667 57.557333 47.573333 23.04 19.925333 42.24 43.264 60.544 67.413334 19.882667 26.282667 36.522667 54.570667 50.986667 84.053333 16.768 34.133333 29.696 69.632 37.973333 106.581333 4.394667 19.541333 7.04 39.424 10.325333 59.178667 4.949333 29.44 4.522667 59.178667 3.541334 88.789333-0.597333 18.218667-3.754667 36.352-6.058667 54.485334a453.973333 453.973333 0 0 1-24.106667 96c-12.544 34.986667-28.288 68.565333-48.725333 99.754666-11.818667 18.005333-23.466667 36.352-37.376 52.736a672.853333 672.853333 0 0 1-57.770667 60.8 498.517333 498.517333 0 0 1-102.016 72.106667c-30.293333 16.213333-61.696 29.866667-94.549333 40.192a463.36 463.36 0 0 1-81.450667 18.602667c-16.725333 2.090667-33.536 3.925333-50.346666 4.906666-17.92 1.066667-35.84 1.792-53.717334 1.152a414.848 414.848 0 0 1-49.706666-4.906666c-22.058667-3.413333-44.288-6.869333-65.749334-12.672a688.426667 688.426667 0 0 1-70.912-23.765334c-34.986667-13.653333-67.84-31.744-98.261333-53.632-16.64-11.946667-32.682667-24.704-48.256-37.973333a490.666667 490.666667 0 0 1-36.010667-34.133333 465.28 465.28 0 0 1-66.048-86.186667 671.146667 671.146667 0 0 1-28.885333-52.992 456.405333 456.405333 0 0 1-34.389333-99.328c-4.181333-19.370667-7.68-38.954667-10.112-58.581333-2.602667-20.906667-3.626667-41.984-5.290667-63.018667l2.56-0.085333z"
            fill="#d81e06"
            p-id="3190"
          />
          <path
            d="M577.92 301.44v262.826667c-0.042667 21.12-18.645333 36.906667-38.314667 38.144a42.069333 42.069333 0 0 1-38.826666-17.834667c-5.973333-8.192-7.765333-17.792-7.765334-27.306667-0.170667-170.24-0.213333-340.48-0.042666-510.762666 0-19.072 7.466667-34.901333 26.282666-42.368 27.818667-11.008 58.666667 6.912 58.666667 36.266666v261.034667z"
            fill="#d81e06"
            p-id="3191"
          />
        </svg>
      </div>
    )
  }

  render() {
    return (
      <div class="hello" flex justify-content-center align-items-center>
        <div class="card" flex align-items-center justify-content-space-between>
          <div flex align-items-center>
            <img
              avatar
              src={
                this.isLogin
                  ? this.user.head
                    ? this.user.fullhead
                    : common.default_head
                  : common.default_head
              }
            />
            <div flex flex-column justify-content-center>
              <h4 name>{this.isLogin ? this.user.name : '未登录用户'}</h4>
              <div class="otherinfo" flex flex-column justify-content-center>
                <span>{this.isLogin ? this.user.department : '未知'}</span>
              </div>
            </div>
          </div>
          {this.isLogin ? this.toEnterAdmin() : this.toLoginHtml()}
        </div>
        {this.isLogin ? this.logoutHtml() : ''}
      </div>
    )
  }
})
